import pandas as pd
import numpy as np

data = {
    "student_id": [1, 1, 2, 3, 3, 4],
    "student_name": ["Rahul Sharma", "Rahul Sharma", "Priya Singh", "Aman Verma", "Aman Verma", "Fake Student"],
    "course_id": [1, 2, 1, 3, 2, 3],
    "course_title": ["Python Basics", "Databases 101", "Python Basics", "Data Science with Python", "Databases 101", "Data Science with Python"],
    "completion": [20, None, 100, 75, -5, 110],   # invalid values (None, negative, >100)
    "last_updated": ["2025-09-01", "2025-09-05", "2025-09-10", None, "2025-09-12", "2025-09-13"]
}

df = pd.DataFrame(data)
df.to_csv("progress_data.csv", index=False)

print("=== Raw Data ===")
print(pd.read_csv("progress_data.csv"))

df = pd.read_csv("progress_data.csv")

df['completion'] = df['completion'].fillna(0)

df['completion'] = np.clip(df['completion'], 0, 100)

df = df.dropna(subset=['student_name'])

df['last_updated'] = df['last_updated'].fillna(pd.Timestamp.today().strftime("%Y-%m-%d"))

print("\n=== Cleaned Data ===")
print(df)

avg_progress = np.mean(df['completion'])
print("\nOverall Average Completion: ", round(avg_progress, 2), "%")

course_summary = df.groupby('course_title')['completion'].mean().reset_index()
course_summary.rename(columns={'completion': 'avg_completion'}, inplace=True)

print("\n=== Course-Level Average Completion ===")
print(course_summary)

df.to_csv("cleaned_progress_data.csv", index=False)
course_summary.to_csv("course_summary.csv", index=False)

